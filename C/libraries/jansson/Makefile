.PHONY: all static clean deinit

ifeq ($(INIT_DIR_PATH),)
REL_ROOT=../../../build/linux/
include $(REL_ROOT)MakeDirPaths
endif

# the static library
TARGET=$(DIR_JANSSON_SRC)src/.libs/libjansson.a

# Make file generated by running `./configure` script
AUTO_MAKE=$(DIR_JANSSON_SRC)Makefile

# `./configure` script generated by running `autoreconf -i`
CONFIG=$(DIR_JANSSON_SRC)configure

# input to `autoreconf -i` is part of Jansson git repo
AUTO_CONFIG=$(DIR_JANSSON_SRC)configure.ac

# by default, build static library
all: static

# build static library
static: $(TARGET)

# use Make file to build library
$(TARGET): $(AUTO_MAKE)
	cd $(DIR_JANSSON_SRC) && $(MAKE)

# Configure project
$(AUTO_MAKE): $(CONFIG)
	cd $(DIR_JANSSON_SRC) && ./configure --with-pic

# generate project configuration script
$(CONFIG): $(AUTO_CONFIG)
	cd $(DIR_JANSSON_SRC) && autoreconf -i
	
# init git module, check out proper commit
$(AUTO_CONFIG):
	git submodule init
	git submodule update
	
# run Jansson's make clean
clean: $(AUTO_MAKE)
	cd $(DIR_JANSSON_SRC) && $(MAKE) clean
	
# de-initialize the jansson submodule
deinit:
	git submodule deinit -f $(DIR_JANSSON_SRC)